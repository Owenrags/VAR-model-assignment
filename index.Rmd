---
title: 'VAR/VECM Project'
author: "Owen Ragsdale"
date: "`r format(Sys.Date(),'%B %d, %Y')`"
output: 
  html_document:
    df_print: paged
    code_folding: "hide"
    toc: yes
    fig_caption: yes
    theme: cerulean
    toc_float: no
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
graphics.off()

```
```{r packages, include=FALSE}
require(fpp3)
require(tidyverse)
require(dplyr)
require(tidyquant)
require(lubridate)
require(timetk)
require(vars)
require(lmtest)
require(kableExtra)
require(lmtest)
```

```{r data, include=FALSE}
varList <- c("MRTSSM4453USS", "UNRATE")
X <- tq_get(varList, get = "economic.data", from = "1992-01-01") %>%
  mutate(Month = yearmonth(date)) %>% dplyr::select(-date) %>%
  as_tsibble(index = Month, key = symbol)
New_x <- X %>%
  pivot_wider(names_from = symbol, values_from = price) %>%
  as_tsibble()

```

### _Executive Summary_

This white paper seeks insight into the causality and correlation between two variables, in this case the unemployment rate and retail sales: beer, wine, and liquor sales from 1992 until February of 2022. Prior to the analysis the expected outcome was that as unemployment increased, we would see an increase in retail sales of alcoholic beverages. After adjusting the data and using a Vector Autoregression Model (VAR) we found that their is no significant causality between the two variables. 

### _Introduction_



To see the entire project and code please click the link below.

[link](https://owenrags.github.io/)

### _Data selection & manipulation_

```{r plot}
X %>% ggplot(aes(x = Month, y = price)) +
  geom_line() +
  facet_grid(vars(symbol), scales = "free_y")
```

```{r unitroot}
X %>% 
  features(price, unitroot_ndiffs) %>%
  kable(format = "html", table.attr = "style='width:30%;' ") %>%
  kableExtra::kable_styling()

```

```{r kpss}
X %>% filter(symbol == "MRTSSM4453USS") %>%
  features(log(price), unitroot_kpss) %>%
  kable(format = "html", table.attr = "style='width:30%;' ") %>%
  kableExtra::kable_styling()
```

```{r kpss2.0}
X %>% filter(symbol == "UNRATE") %>%
  features(log(price), unitroot_kpss) %>%
  kable(format = "html", table.attr = "style='width:30%;' ") %>%
  kableExtra::kable_styling()
```


```{r }
Zdrink <- New_x %>% 
 mutate(gMRTSSM4453USS = 100 * difference(difference(log(MRTSSM4453USS)))) %>%
    dplyr::select(gMRTSSM4453USS, UNRATE) %>%
    tidyr::drop_na()
Zdrink <- as.ts(Zdrink, start = c(1992,2), frequency = 12)

```

```{r}
zh <- Zdrink[,c(2,1)]
tmp <- VARselect(zh,lag.max = 9, type="const")
tmp
```

```{r}
p <- tmp$selection[2]

```

```{r}
var.Zdrink <- VAR(zh, p=p, type = "const")
summary(var.Zdrink)

```

```{r}

grangertest(gMRTSSM4453USS ~ UNRATE, order=p, data = zh)

```

```{r}

grangertest(UNRATE ~ gMRTSSM4453USS, order=p, data = zh)

```

### _Results of the VAR Model_


```{r}

plot(irf(var.Zdrink, n.ahead = 6, boot = TRUE))

```


### _Conclusion_